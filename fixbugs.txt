this is the bug fixed in issue1208
fix some bugs
and add some feature in issue1208
